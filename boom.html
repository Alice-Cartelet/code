<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ç‚¸å¼¹è®¡æ—¶</title>

<style>
    body {
        margin: 0;
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        background: #111;
        color: white;
        font-family: -apple-system, BlinkMacSystemFont, sans-serif;
        overflow: hidden;
    }

    #container {
        text-align: center;
        z-index: 10;
    }

    button {
        font-size: 22px;
        padding: 14px 40px;
        border: none;
        border-radius: 10px;
        background: #ff3b30;
        color: white;
        cursor: pointer;
    }

    #status {
        font-size: 24px;
        margin-top: 20px;
        display: none;
    }

    #flash {
        position: fixed;
        inset: 0;
        background: red;
        opacity: 0;
        pointer-events: none;
    }

    .explode {
        animation: flash 0.45s ease-in-out;
    }

    @keyframes flash {
        0%   { opacity: 0; }
        25%  { opacity: 1; }
        55%  { opacity: 0.4; }
        100% { opacity: 0; }
    }
</style>
</head>

<body>

<div id="flash"></div>

<div id="container">
    <button id="startBtn">å¼€å§‹</button>
    <div id="status">è®¡æ—¶ä¸­â€¦</div>
</div>

<script>
let audioCtx = null;

const startBtn = document.getElementById("startBtn");
const statusText = document.getElementById("status");
const flash = document.getElementById("flash");

function playExplosion() {
    const ctx = audioCtx;

    // === å™ªå£° ===
    const bufferSize = ctx.sampleRate * 1.2; // å£°éŸ³æ›´é•¿
    const buffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);
    const data = buffer.getChannelData(0);

    for (let i = 0; i < bufferSize; i++) {
        data[i] = Math.random() * 2 - 1;
    }

    const source = ctx.createBufferSource();
    source.buffer = buffer;

    // === ä½Žé€šï¼ˆä½Žé¢‘æ›´çŒ›ï¼‰ ===
    const filter = ctx.createBiquadFilter();
    filter.type = "lowpass";
    filter.frequency.value = 500;

    // === éŸ³é‡ï¼ˆæ˜¾è‘—å¢žå¼ºï¼‰ ===
    const gain = ctx.createGain();
    gain.gain.setValueAtTime(2.8, ctx.currentTime); // ðŸ”¥ åŽŸæ¥â‰ˆ1ï¼ŒçŽ°åœ¨â‰ˆ3å€
    gain.gain.exponentialRampToValueAtTime(
        0.02,
        ctx.currentTime + 1.1
    );

    source.connect(filter);
    filter.connect(gain);
    gain.connect(ctx.destination);

    source.start();
    source.stop(ctx.currentTime + 1.2);
}

function explodeEffect() {
    flash.classList.remove("explode");
    void flash.offsetWidth;
    flash.classList.add("explode");

    if (navigator.vibrate) {
        navigator.vibrate([250, 80, 250]);
    }
}

startBtn.addEventListener("click", () => {
    if (!audioCtx) {
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    }

    startBtn.style.display = "none";
    statusText.style.display = "block";

    const randomTime = Math.random() * 20000;

    setTimeout(() => {
        playExplosion();
        explodeEffect();

        statusText.style.display = "none";
        startBtn.style.display = "inline-block";
    }, randomTime);
});
</script>

</body>
</html>